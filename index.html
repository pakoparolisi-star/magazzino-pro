<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Magazzino</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f2f2f7;
  margin:0;
  padding:10px;
}
h1{text-align:center}
.card{
  background:#fff;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
input,button{
  padding:8px;
  font-size:16px;
}
button{margin:2px}
.prod{
  border-left:10px solid #000;
}
.qty{
  font-size:20px;
  font-weight:bold;
}
.controls button{
  min-width:48px;
}
</style>
</head>

<body>
<h1>ðŸ“¦ Magazzino</h1>

<div class="card">
  <input id="cat" placeholder="Categoria"><br><br>
  <input id="name" placeholder="Nome prodotto"><br><br>
  Colore:
  <input type="color" id="color" value="#4CAF50"><br><br>
  <button onclick="addProduct()">Salva prodotto</button>
</div>

<div id="list"></div>

<script>
let db;

const openDB = indexedDB.open("magazzinoDB",1);

openDB.onupgradeneeded=e=>{
  db=e.target.result;
  db.createObjectStore("prodotti",{keyPath:"id",autoIncrement:true});
};

openDB.onsuccess=e=>{
  db=e.target.result;
  load();
};

function addProduct(){
  const name=document.getElementById("name").value.toUpperCase();
  if(!name)return;
  const tx=db.transaction("prodotti","readwrite");
  tx.objectStore("prodotti").add({
    categoria:document.getElementById("cat").value,
    nome:name,
    colore:document.getElementById("color").value,
    qty:0
  });
  tx.oncomplete=()=>{load();document.getElementById("name").value=""};
}

function load(){
  document.getElementById("list").innerHTML="";
  const tx=db.transaction("prodotti","readonly");
  tx.objectStore("prodotti").openCursor().onsuccess=e=>{
    const c=e.target.result;
    if(c){
      const p=c.value;
      const d=document.createElement("div");
      d.className="card prod";
      d.style.borderColor=p.colore;
      d.innerHTML=`
        <b>${p.categoria || ""}</b><br>
        ${p.nome}<br>
        <div class="qty">${p.qty}</div>
        <div class="controls">
          ${[-10,-5,-4,-3,-2,-1,1,2,3,4,5,10].map(n=>
            `<button onclick="upd(${c.key},${n})">${n>0?"+":""}${n}</button>`
          ).join("")}
        </div>
        <button onclick="reset(${c.key})">Reset</button>
        <button onclick="del(${c.key})">Elimina</button>
      `;
      document.getElementById("list").appendChild(d);
      c.continue();
    }
  }
}

function upd(id,n){
  const tx=db.transaction("prodotti","readwrite");
  const st=tx.objectStore("prodotti");
  st.get(id).onsuccess=e=>{
    const p=e.target.result;
    p.qty+=n;
    st.put(p);
  };
  tx.oncomplete=load;
}

function reset(id){
  if(!confirm("Azzerare quantitÃ ?"))return;
  const tx=db.transaction("prodotti","readwrite");
  const st=tx.objectStore("prodotti");
  st.get(id).onsuccess=e=>{
    const p=e.target.result;
    p.qty=0;
    st.put(p);
  };
  tx.oncomplete=load;
}

function del(id){
  if(!confirm("Eliminare prodotto?"))return;
  const tx=db.transaction("prodotti","readwrite");
  tx.objectStore("prodotti").delete(id);
  tx.oncomplete=load;
}
</script>
</body>
</html>
